<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>Inside the Horde</title>
<base target="_blank" />
<!-- metadata -->
<meta name="generator" content="S5" />
<meta name="version" content="S5 1.1" />
<meta name="presdate" content="2009-06-26" />
<meta name="author" content="Jan Schneider" />
<!-- configuration parameters -->
<meta name="defaultView" content="slideshow" />
<meta name="controlVis" content="hidden" />
<!-- style sheet links -->
<link rel="stylesheet" href="../s5/ui/slides.css" type="text/css" media="projection" id="slideProj" />
<link rel="stylesheet" href="../s5/ui/outline.css" type="text/css" media="screen" id="outlineStyle" />
<link rel="stylesheet" href="../s5/ui/print.css" type="text/css" media="print" id="slidePrint" />
<link rel="stylesheet" href="../s5/ui/opera.css" type="text/css" media="projection" id="operaFix" />
<link rel="stylesheet" href="../s5/ui/SyntaxHighlighter/SyntaxHighlighter.css" type="text/css" media="screen"></link>
<style type="text/css">
.slidecontent img {
  float: right;
}
</style>
<style type="text/css" media="print">
.slidecontent img {
  display: none;
}
</style>
<!-- S5 JS -->
<script src="../s5/ui/slides.js" type="text/javascript"></script>
<!-- prototype + scriptaculous -->
<script src="../s5/ui/prototype/prototype.js" type="text/javascript"></script>
<script src="../s5/ui/scriptaculous/scriptaculous.js" type="text/javascript"></script>
<!-- Presentaculous JS -->
<script src="../s5/ui/presentacular.js" type="text/javascript"></script>
<!-- Syntax highlighting JS -->
<script src="../s5/ui/SyntaxHighlighter/shCore.js" type="text/javascript"></script>
<script src="../s5/ui/SyntaxHighlighter/shBrushPhp.js" type="text/javascript"></script>
<script type="text/javascript">
Event.observe(window, 'load', function() {
    dp.SyntaxHighlighter.HighlightAll('code');
});
</script>
</head>
<body>

<div class="layout">
 <div id="currentSlide"></div>
 <div id="header"></div>
 <div id="footer">
  <h1>Porto Alegre &#8226; June 26th 2009</h1>
  <h2>Inside the Horde</h2>
  <div id="controls"></div>
 </div>
</div>

<!-- Begin presentation -->
<div class="presentation">

<div class="slide">
<h1>Inside the Horde</h1>
<h3>Jan Schneider</h3>
<h4><a href="http://www.horde.org/">The Horde Project</a></h4>
</div>

<div class="slide">
<h1>Administrator GUI tools</h1>
<div class="slidecontent">
<p>Let's start with something easy to get warm. A quick run through the administration tools.</p>
<h2 class="note">Demonstration</h2>
<ul style="font-size:75%">
  <li>Setup</li>
  <li>Users</li>
  <li>Groups</li>
  <li>Permissions</li>
  <li>Alarms</li>
  <li>Sessions</li>
  <li>PHP Shell</li>
  <li>SQL Shell</li>
  <li>CLI</li>
</ul>
</div>
</div>

<div class="slide">
<h1>7 Ways of Customization</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>Themes</li>
  <li>Configuration</li>
  <li>Preferences</li>
  <li>Permissions</li>
  <li>Hooks</li>
  <li>APIs</li>
  <li>Drivers</li>
</ul>
</div>
</div>

<div class="slide">
<h1>Themes</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>Easy way to change look, to create a CI</li>
  <li>Consist of CSS rules and an optional icon set</li>
  <li>&quot;Traditional&quot; applications more or less colors and fonts</li>
  <li>&quot;Modern&quot; applications like DIMP completely CSS rendered</li>
  <li>Real cascading through hierarchical CSS file loading</li>
</ul>
</div>
</div>

<div class="slide">
<h1>Configuration</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>All configuration files go into the application's <code>config/</code> directory: <code>conf.php</code>, <code>prefs.php</code>, <code>mime_drivers.php</code>, application specific files</li>
  <li>Note: all configuration files are PHP code</li>
  <li>Virtual host specific configuration
    <ul>
      <li>Set <code>$conf['vhosts'] = true</code></li>
      <li>Go to http://www.example.com/</li>
      <li>Horde loads <code>config/conf.php</code>, <code>config/www.example.com-conf.php</code>, etc</li>
    </ul>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>Advanced Configuration Examples</h1>
<div class="slidecontent">
<p>Custom login or logout pages</p>
<ul class="incremental">
  <li>Not that advanced actually</li>
  <li>Redirect on unauthorized access</li>
  <li>Redirect on logging out</li>
  <li>Enabled in Horde or IMP configuration, depdending on authentication</li>
  <li><code>$conf['auth']['alternate_login'] = 'http://www.example.com/mylogin.php';</code></li>
  <li>Example script for IMP in <code>imp/scripts/cutom_login.php</code></li>
</ul>
</div>
</div>

<div class="slide">
<h1>Advanced Configuration Examples</h1>
<div class="slidecontent">
<p>Custom email headers, signatures, trailers</p>
<ul class="incremental">
  <li>Track users (spammers)</li>
  <li>Identify machines (in a cluster)</li>
  <li>Add company signature, disclaimer</li>
  <li>Keep user signatures flexible (changing offices, positions, numbers)</li>
</ul>
</div>
</div>

<div class="slide">
<h1>Advanced Configuration Examples</h1>
<div class="slidecontent">
<p>Composite authentication</p>
<ul class="incremental">
  <li>Different authentication drivers for different purposes (authentication, user management/listing)</li>
  <li>Example:
    <ul>
      <li>Want to have view switch on login screen &rarr; IMP authentication</li>
      <li>Want to have signups &rarr; SQL authentication</li>
    </ul>
  </li>
  <li>See <a href="http://wiki.horde.org/AuthCompositeHowTo">http://wiki.horde.org/AuthCompositeHowTo</a> for detailed instructions</li>
</ul>
</div>
</div>

<div class="slide">
<h1>Preferences</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>Defined in <code>config/prefs.php</code></li>
  <li>Individual preferences in <code>$_prefs</code>, grouping in <code>$prefGroups</code></li>
  <li>Grouping just cosmetical
    <textarea name="code" class="php" rows="10" cols="100">
$prefGroups['drafts'] = array(
    'column' => _("Message Options"),
    'label' => _("Message Drafts"),
    'desc' => _("Customize how to deal with message drafts."),
    'members' => array('folderselect', 'close_draft', 'unseen_drafts')
);
    </textarea>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>Preferences</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>Actual preference
    <textarea name="code" class="php" rows="10" cols="100">
$_prefs['first_week_day'] = array(
    'value' => '0',
    'locked' => false,
    'shared' => true,
    'type' => 'enum',
    'desc' => _("Which day would you like to be displayed as the first day of the week?"),
    'enum' => array('0' => _("Sunday"),
                    '1' => _("Monday"))
);
    </textarea>
  </li>
  <li>Preference types: checkbox, number, text, password, etc.</li>
  <li>More preference stuff later with hooks</li>
</ul>
</div>
</div>

<div class="slide">
<h1>Permissions</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>Who?
    <ul>
      <li>Guests, anyone</li>
      <li>Authenticated users</li>
      <li>Individual users</li>
      <li>Groups</li>
      <li>Object owners</li>
    </ul>
  </li>
  <li>What?
    <ul>
      <li>Show</li>
      <li>Read</li>
      <li>Write</li>
      <li>Delete</li>
      <li>(Delegate)</li>
    </ul>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>Permissions</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>Where?
    <ul>
      <li>Application access</li>
      <li>Application-level limits
        <ul>
          <li>Maximum number of resources (folders, events, contacts, etc)</li>
          <li>Access to resources (address books)</li>
          <li>Feature limitiation (creating folders)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>How?
    <ul>
      <li>Go to the permissions screen in the administration area</li>
      <li>Add permissions for an application</li>
      <li>Remember to set permissions, default is no access for anyone</li>
      <li>Add sub-permissions, that's where the cool stuff is</li>
    </ul>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>Hooks</h1>
<div class="slidecontent">
<p>The swiss army knife of Horde manipulation</p>
<ul class="incremental">
  <li>Preference hooks
    <ol>
      <li>Reading default preference values (lock them?)</li>
      <li>Called when saving preferences</li>
    </ol>
  </li>
  <li>Pre-authentication/post-authentication hooks</li>
  <li>and more...</li>
  <li>Application-specific hooks</li>
</ul>
</div>
</div>

<div class="slide">
<h1>Preference Hook Examples</h1>
<div class="slidecontent">
  <p>Classics: email address, full name</p>
  <textarea name="code" class="php" rows="10" cols="100">
if (!function_exists('_prefs_hook_from_addr')) {
    function _prefs_hook_from_addr($user = null)
    {
        $ldapServer = '172.31.0.236';
        $ldapPort = '389';
        $searchBase = 'o=myorg';
        $ds = @ldap_connect($ldapServer, $ldapPort);

        $searchResult = @ldap_search($ds, $searchBase, 'cn=' . $user);
        $information = @ldap_get_entries($ds, $searchResult);
        if ($information === false || $information['count'] == 0) {
            return '';
        }
        if ($information[0]['mail'][0] != '') {
            return $information[0]['mail'][0];
        }
        return $information[0]['cn'][0];
    }
}
  </textarea>
</div>
</div>

<div class="slide">
<h1>Preference Hook Examples</h1>
<div class="slidecontent">
  <p>Real world example: custom preferences through web service</p>
  <textarea name="code" class="php" rows="10" cols="100">
if (!function_exists('_prefs_hook_newsletter')) {
    function _prefs_hook_newsletter($user = null)
    {
        $client = new SoapClient('http://www.example.com/webservice.wsdl);
        try {
            $status = $client->getNewsletterStatus(Auth::getAuth());
        } catch (SoapFault $e) {
            Horde::logMessage($e, __FILE__, __LINE__, PEAR_LOG_ERR);
            return false;
        }
        return $status;
    }
}

if (!function_exists('_prefs_change_hook_newsletter')) {
    function _prefs_change_hook_newsletter()
    {
        $client = new SoapClient('http://www.example.com/webservice.wsdl');
        try {
            $client->setNewsletterStatus(Auth::getAuth(), $GLOBALS['prefs']->getValue('newsletter'));
        } catch (SoapFault $e) {
            Horde::logMessage($e, __FILE__, __LINE__, PEAR_LOG_ERR);
        }
    }
}
  </textarea>
</div>
</div>

<div class="slide">
<h1>Authentication Hook Example</h1>
<div class="slidecontent">
  <p>Real world example: force users to accept a TOS and change passwords on login</p>
  <p><a href="source.php?file=authhook">Code</a></p>
</div>
</div>

<div class="slide">
<h1>Signup Hook Example</h1>
<div class="slidecontent">
  <p>Real world example: request preference defaults, enforce TOS, normalize user names</p>
  <p><a href="source.php?file=signuphook">Code</a></p>
</div>
</div>

<div class="slide">
<h1>More Hooks</h1>
<div class="slidecontent">
<p>More hooks and possible use cases</p>
<ul class="incremental">
  <li>User name hooks (_username_hook_frombackend, _username_hook_tobackend, _imp_hook_vinfo)
    <ul>
      <li>Normalize user names (all lower-case)</li>
      <li>Strip and add domains</li>
      <li>Conversion between user IDs and user names</li>
    </ul>
  </li>
  <li>Group hooks (_group_hook)
    <ul>
      <li>Dynamically determine group membership</li>
    </ul>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>Application Hooks</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>IMP
    <ul>
      <li>Mailbox listing (show attachment icons, parse X-Priority headers)</li>
      <li>Filter fetchmail messages</li>
      <li>Add/change trailers and signatures</li>
      <li>Display special mailbox icons</li>
      <li>Quota driver</li>
    </ul>
  </li>
  <li>DIMP
    <ul>
      <li>Mailbox listing (show attachment icons, parse X-Priority headers)</li>
      <li>Modify message view/preview</li>
    </ul>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>Application Hooks</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>Turba
    <ul>
      <li>Encode/decode contact attributes (massage values for output/storage, hashing/hiding passwords)</li>
    </ul>
  </li>
  <li>Nag/Mnemo
    <ul>
      <li>Description formatting</li>
    </ul>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>APIs</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>All inter-application communication through APIs</li>
  <li>Replace one application with another, just implement the API</li>
  <li>Examples:
    <ul>
      <li>Have your own blacklist/whitelist solution? Implement API methods <code>mail/blacklistFrom</code>, <code>mail/showBlacklist</code>, etc.</li>
      <li>Have your own address book application? Implement the <code>contacts</code> API.</li>
      <li>Want to integrate a different ticket system than Whups? Write a wrapper around Bugzilla/OTRS implementing the <code>tickets</code> API.</li>
    </ul>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>APIs</h1>
<div class="slidecontent">
<p>Registering an application at the Horde registry <code>config/registry.php</code>:</p>
<textarea name="code" class="php" rows="10" cols="100">
$this->applications['imp'] = array(
    'fileroot' => dirname(__FILE__) . '/../imp',
    'webroot' => $this->applications['horde']['webroot'] . '/imp',
    'name' => _("Mail"),
    'status' => 'active',
    'provides' => array('mail', 'contacts/favouriteRecipients')
);
</textarea>
</div>
</div>

<div class="slide">
<h1>APIs</h1>
<div class="slidecontent">
<p>Create an API definition in <code>lib/api.php</code>:</p>
<textarea name="code" class="php" rows="10" cols="100">
$_services['blacklistFrom'] = array(
    'args' => array('addresses' => '{urn:horde}stringArray'),
    'type' => 'boolean',
);

$_services['showBlacklist'] = array(
    'link' => '%application%/blacklist.php',
);

function _appname_blacklistFrom($addresses)
{
    // Your code
}
</textarea>
</div>
</div>

<div class="slide">
<h1>APIs</h1>
<div class="slidecontent">
<p>Using APIs to use Horde functionality in your own applications</p>
<ul class="incremental">
  <li>RSS feeds</li>
  <li>Embeddable widgets
    <textarea name="code" class="php" rows="10" cols="100">
&lt;div id=&quot;kronolithCal&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;http://tank.wg.de/groupware/kronolith/imple.php?imple=Embed/container=kronolithCal/view=month/calendar=guest&quot; type=&quot;text/javascript&quot;&gt;
&lt;/script&gt;
    </textarea>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>APIs</h1>
<div class="slidecontent">
<p>Using APIs to use Horde functionality in your own applications</p>
<ul class="incremental">
  <li>Direct PHP API calls through registry
    <textarea name="code" class="php" rows="10" cols="100">
$registry = &Registry::singleton();
$calendars = $registry->call('calendar/listCalendars');
    </textarea>
    More documentation on the wiki: <a href="http://wiki.horde.org/Doc/Dev/Registry">http://wiki.horde.org/Doc/Dev/Registry</a>
  </li>
  <li>Use http://www.example.com/horde/rpc.php as an endpoint for
    <ul>
      <li>SOAP</li>
      <li>XML-RPC</li>
      <li>JSON-RPC</li>
      <li>WebDAV</li>
    </ul>
  </li>
</ul>
</div>
</div>

<div class="slide">
<h1>Drivers</h1>
<div class="slidecontent">
<ul class="incremental">
  <li>Your favorite backend for a library or application is not supported?</li>
  <li>Create a driver!</li>
  <li>Take an existing driver as a blueprint</li>
  <li>Start hacking</li>
  <li>Examples:
    <ul class="incremental">
      <li>New authentication driver: <code>lib/Auth/mydriver.php</code></li>
      <li>New address book driver. <code>turba/lib/Driver/mydriver.php</code></li>
    </ul>
  </li>
</ul>
</div>
</div>

<!-- Fin -->
<div class="slide">
 <h1>Questions?</h1>
</div>

<div class="slide">
 <h1>Resources</h1>
 <ul>
  <li>My website: <a href="https://web-horde.org/w/janschneider.de/">http://janschneider.de/</a></li>
  <li>The Horde website: <a href="http://www.horde.org/">http://www.horde.org/</a></li>
  <li>Developer resources: <a href="http://dev.horde.org/">http://dev.horde.org/</a></li>
  <li>Developer documentation: <a href="http://wiki.horde.org/Doc/Dev">http://wiki.horde.org/Doc/Dev/</a></li>
  <li>Mailing lists: <a href="http://www.horde.org/mail/">http://www.horde.org/mail/</a></li>
  <li>These slides: <a href="http://www.horde.org/papers/">http://www.horde.org/papers/</a></li>
 </ul>
</div>

<div class="slide">
 <h1>Obrigado!</h1>
</div>

<!-- End Slides -->
</div>
</body>
</html>
